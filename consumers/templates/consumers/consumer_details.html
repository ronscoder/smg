{% load my_filters %}
<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>consumer_details of {{consumer_details.consumer_id}}</title>
  <!-- Other head elements like CSS links -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
  crossorigin="" />
<!-- Make sure you put this AFTER Leaflet's CSS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
  integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
  crossorigin=""></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
<style type="text/tailwindcss">
  @theme {
    --color-clifford: #da373d;
  }
</style>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
{% verbatim %}
    <div id="app">
      <button @click="fetchData">Fetch Data</button>
      <p v-if="data">{{ data }}</p>
      <p v-if="error">{{ error }}</p>
      <p v-if="loading.value">loading</p>
    </div>
{% endverbatim %}
    <script>
      const { createApp, ref } = Vue;

      createApp({
        setup() {
          const data = ref(null);
          const error = ref(null);
          const loading = ref(false);

          const fetchData = async () => {
            try {
              loading.value = true;
              const response = await axios.get('https://jsonplaceholder.typicode.com/todos/1'); // Replace with your API endpoint
              data.value = response.data;
              error.value = null;
            } catch (err) {
              error.value = 'Error fetching data: ' + err.message;
              data.value = null;
            }
          };
          loading.value = false
          return {
            data,
            error,
            fetchData,
            loading
          };
        }
      }).mount('#app');
    </script>

<div>
<div id="snap1">
{{consumer_details|get_field_value|safe}}
</div>
<div>
<div id="map"></div>
</div>
</div>
<style>
#map {
height: 180px;
}
</style>
<script>
html2canvas(document.getElementById('snap1')).then(function(canvas) {
// The 'canvas' variable now holds the image of your div
// You can append it to the document body or convert it to an image file
//document.body.appendChild(canvas); // Appends the canvas to the page
});
html2canvas(document.getElementById('snap1')).then(function(canvas) {
const imageDataURL = canvas.toDataURL('image/png'); // Get image data as PNG
const link = document.createElement('a');
link.href = imageDataURL;
link.download = 'div_screenshot.png'; // Suggested filename
//link.click(); // Trigger download
});
</script>
<script>

var defaultlatlng = [24.823, 93.957];
//var latlng = data.fields.location.split(",");
var loc = "{{location}}";
var consumerId = "{{consumer_id}}";
if (loc == "") {
var latlng = defaultlatlng
} else
var latlng = loc.split(",");
var map = L.map('map').setView(latlng, 13);
L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
maxZoom: 19,
attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
}).addTo(map);
var markers = [];
var marker = L.marker(latlng);
//markers.push(marker)
marker.bindPopup("current").openPopup();
marker.addTo(map);
//marker.setStyle({fillColor: 'green'});
function onMapClick(e) {
// alert("You clicked the map at " + e.latlng);
for (i = 0; i < markers.length; i++) {
map.removeLayer(markers[i]);
}
var marker = L.marker(e.latlng).addTo(map);
markers.push(marker)
}

map.on('click', onMapClick)
</script>

</body>
</html>